<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Jaroslav's Game Collectie</title>
    <script src="xlsx.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #e0e0e0; margin: 0; padding: 20px; overflow-x: hidden; }
        .container { max-width: 1100px; margin: 0 auto; text-align: center; transition: margin-left 0.3s; }
        
        /* Hamburger Menu / Sidebar */
        .sidebar {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            background-color: #1a1a1a;
            overflow-x: hidden;
            transition: 0.3s;
            padding-top: 60px;
            border-right: 1px solid #333;
            text-align: left;
        }

        .sidebar-content { padding: 20px; min-width: 300px; }

        .closebtn {
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
            color: #888;
            text-decoration: none;
            cursor: pointer;
        }

        .openbtn {
            font-size: 20px;
            cursor: pointer;
            background-color: #1e1e1e;
            color: #00ffcc;
            padding: 10px 15px;
            border: 1px solid #333;
            border-radius: 8px;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 999;
            transition: 0.3s;
        }
        .openbtn:hover { background: #333; }

        /* Header & Controls */
        .header-controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 25px; margin-top: 20px; flex-wrap: wrap; }
        .search-container { position: relative; width: 100%; max-width: 500px; }
        #search-input { width: 100%; padding: 12px 45px 12px 20px; border-radius: 25px; border: 2px solid #333; background: #1e1e1e; color: white; font-size: 1em; outline: none; box-sizing: border-box; }
        #search-input:focus { border-color: #00ffcc; }
        #clear-search { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; font-size: 20px; cursor: pointer; display: none; }

        .mini-upload { background: #1e1e1e; border: 1px solid #333; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.8em; color: #888; }
        #upload, #upload-large { display: none; }

        .upload-box { background: #1e1e1e; padding: 40px; border-radius: 15px; border: 2px dashed #00ffcc; margin-bottom: 30px; }

        /* Tabs Styling */
        .tabs { display: flex; justify-content: center; gap: 8px; margin-bottom: 25px; flex-wrap: wrap; }
        .tab-button { background: #252525; color: white; border: 1px solid #333; padding: 10px 18px; cursor: pointer; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        .tab-button.active { background: #00ffcc; color: #000; border-color: #00ffcc; }
        .tab-button.no-results { opacity: 0.2; pointer-events: none; }

        .console-content { display: none; background: #1e1e1e; padding: 20px; border-radius: 12px; text-align: left; }
        .console-content.active, .console-content.searching { display: block; }
        
        /* Overzicht Tabel in Sidebar */
        .summary-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .summary-table th { color: #00ffcc; text-align: left; padding: 8px; border-bottom: 2px solid #333; }
        .summary-table td { padding: 8px; border-bottom: 1px solid #2a2a2a; }
        .summary-table tr.total-row { font-weight: bold; color: #00ffcc; background: #121212; }

        .group-section { border-left: 4px solid #00ffcc; padding: 15px; margin-bottom: 30px; background: #181818; border-radius: 8px; }
        .ps-group { border-left-color: #00439c; } 
        .nintendo-group { border-left-color: #e60012; }
        .pc-group { border-left-color: #f3af19; } 
        .xbox-group { border-left-color: #107c10; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #333; vertical-align: middle; }
        th { color: #00ffcc; text-align: left; }
        .game-thumb { width: 50px; height: auto; border-radius: 4px; }
        
        .hidden { display: none !important; }
        html { scroll-behavior: smooth; }
    </style>
</head>
<body>

<div id="mySidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <div class="sidebar-content">
        <h2 style="color: #00ffcc;">üìà Overzicht</h2>
        <div id="sidebar-summary">
            </div>
    </div>
</div>

<button class="openbtn" id="openbtn" onclick="openNav()" style="display:none;">&#9776; Overzicht</button>

<div class="container" id="main">
    <h1>üéÆ Mijn Game Collectie</h1>
    
    <div class="upload-box" id="full-upload-box">
        <h3>Geen database gevonden</h3>
        <p>Zorg dat 'database.xlsx' in de map staat of upload handmatig:</p>
        <label class="mini-upload" style="font-size: 1.2em; padding: 15px 30px;">
            üìÅ Selecteer Excel Bestand
            <input type="file" id="upload-large" accept=".xlsx">
        </label>
    </div>

    <div class="header-controls" id="controls" style="display: none;">
        <div class="search-container">
            <input type="text" id="search-input" placeholder="Zoek een spel...">
            <button id="clear-search">&times;</button>
        </div>
        <label class="mini-upload">üìÅ Wissel Database<input type="file" id="upload" accept=".xlsx"></label>
    </div>

    <div id="tabs" class="tabs"></div>
    <div id="content"></div>
</div>

<script>
    const searchInput = document.getElementById('search-input');
    const clearBtn = document.getElementById('clear-search');
    const fullUploadBox = document.getElementById('full-upload-box');
    const controls = document.getElementById('controls');
    const openBtn = document.getElementById('openbtn');

    // Sidebar Functies
    function openNav() {
        document.getElementById("mySidebar").style.width = "350px";
        document.getElementById("main").style.marginLeft = "350px";
    }

    function closeNav() {
        document.getElementById("mySidebar").style.width = "0";
        document.getElementById("main").style.marginLeft = "auto";
    }

    window.addEventListener('DOMContentLoaded', () => {
        fetch('database.xlsx')
            .then(res => { if (!res.ok) throw new Error(); return res.arrayBuffer(); })
            .then(data => processAndRender(XLSX.read(new Uint8Array(data), {type: 'array'})))
            .catch(() => console.log("Wacht op upload..."));
    });

    document.getElementById('upload').addEventListener('change', handleUpload);
    document.getElementById('upload-large').addEventListener('change', handleUpload);

    function handleUpload(e) {
        const reader = new FileReader();
        reader.onload = (event) => processAndRender(XLSX.read(new Uint8Array(event.target.result), {type: 'array'}));
        reader.readAsArrayBuffer(e.target.files[0]);
    }

    function processAndRender(workbook) {
        const json = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
        fullUploadBox.style.display = 'none';
        controls.style.display = 'flex';
        openBtn.style.display = 'block';
        renderCollectie(json);
    }

    function renderCollectie(data) {
        const groups = {};
        data.forEach(row => {
            const c = row.Console || "Onbekend";
            if (!groups[c]) groups[c] = { games: [] };
            groups[c].games.push(row);
        });

        const allConsoles = Object.keys(groups).sort();
        
        // Nintendo Groepering
        const isNintendo = (n) => {
            const l = n.toLowerCase();
            return l.includes('nintendo') || l.includes('switch') || l.includes('ds') || l.includes('gba') || l.includes('gameboy') || l.includes('wii') || l.includes('gamecube');
        };
        const isPS = (n) => n.toLowerCase().includes('ps') || n.toLowerCase().includes('playstation');
        const isPC = (n) => n.toLowerCase().includes('pc') || n.toLowerCase().includes('steam');
        const isXbox = (n) => n.toLowerCase().includes('xbox');

        const families = [
            { name: "PlayStation Family", list: allConsoles.filter(isPS), style: "ps-group" },
            { name: "Nintendo World", list: allConsoles.filter(isNintendo), style: "nintendo-group" },
            { name: "PC Gaming", list: allConsoles.filter(isPC), style: "pc-group" },
            { name: "Xbox Family", list: allConsoles.filter(isXbox), style: "xbox-group" }
        ];

        const groupedSet = new Set();
        families.forEach(f => f.list.forEach(c => groupedSet.add(c)));
        const others = allConsoles.filter(c => !groupedSet.has(c));

        // --- SIDEBAR OVERZICHT VULLEN ---
        const sidebarSum = document.getElementById('sidebar-summary');
        let sumHtml = `<table class="summary-table">
            <thead><tr><th>Console</th><th>Games</th><th>Waarde</th></tr></thead><tbody>`;
        
        let totalVal = 0, totalGames = 0;
        allConsoles.forEach(c => {
            const cVal = groups[c].games.reduce((s, g) => s + Number(g.Prijs || 0), 0);
            const cCount = groups[c].games.length;
            totalVal += cVal; totalGames += cCount;
            sumHtml += `<tr><td>${c}</td><td>${cCount}</td><td>‚Ç¨${cVal.toFixed(2)}</td></tr>`;
        });
        sumHtml += `<tr class="total-row"><td>TOTAAL</td><td>${totalGames}</td><td>‚Ç¨${totalVal.toFixed(2)}</td></tr></tbody></table>`;
        sidebarSum.innerHTML = sumHtml;

        // --- HOOFD TABS GENEREREN ---
        const tabs = document.getElementById('tabs');
        const content = document.getElementById('content');
        tabs.innerHTML = ""; content.innerHTML = "";

        families.forEach((f, idx) => { if (f.list.length > 0) createTab(f.name, f.list, groups, f.style, idx === 0); });
        others.forEach(name => createTab(name, [name], groups, "", tabs.children.length === 0));

        function createTab(tabName, consoleList, sourceData, extraClass, isActive) {
            const tabId = 'tab-' + tabs.children.length;
            const btn = document.createElement('button');
            btn.className = 'tab-button' + (isActive ? ' active' : '');
            btn.innerText = tabName;
            btn.dataset.tabId = tabId;
            btn.onclick = () => {
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.console-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            };
            
            const div = document.createElement('div');
            div.id = tabId;
            div.className = 'console-content' + (isActive ? ' active' : '');

            consoleList.forEach(cName => {
                const gData = sourceData[cName];
                gData.games.sort((a,b) => (a.Game_Titel||"").localeCompare(b.Game_Titel||""));
                let rows = gData.games.map(g => {
                    const img = g.Foto_URL ? `<img src="${g.Foto_URL}" class="game-thumb" onerror="this.style.display='none'">` : `N/A`;
                    return `<tr class="game-row" data-title="${(g.Game_Titel||"").toLowerCase()}"><td>${img}</td><td>${g.Game_Titel}</td><td>‚Ç¨${Number(g.Prijs||0).toFixed(2)}</td></tr>`;
                }).join('');

                const sec = document.createElement('div');
                sec.className = 'group-section ' + extraClass;
                sec.innerHTML = `<h2>${cName}</h2><table><thead><tr><th>Foto</th><th>Game</th><th>Prijs</th></tr></thead><tbody>${rows}</tbody></table>`;
                div.appendChild(sec);
            });
            tabs.appendChild(btn);
            content.appendChild(div);
        }
    }

    function applySearch() {
        const term = searchInput.value.toLowerCase();
        clearBtn.style.display = term ? "block" : "none";
        document.querySelectorAll('.console-content').forEach(tabDiv => {
            let tabMatch = false;
            tabDiv.querySelectorAll('.group-section').forEach(sec => {
                let secMatch = false;
                sec.querySelectorAll('.game-row').forEach(row => {
                    const match = row.dataset.title.includes(term);
                    row.classList.toggle('hidden', !match);
                    if (match) secMatch = tabMatch = true;
                });
                sec.classList.toggle('hidden', !secMatch);
            });
            const btn = document.querySelector(`[data-tab-id="${tabDiv.id}"]`);
            if (btn) btn.classList.toggle('no-results', term && !tabMatch);
        });
    }

    searchInput.addEventListener('input', applySearch);
    clearBtn.onclick = () => { searchInput.value = ""; applySearch(); };
</script>
</body>
</html>
